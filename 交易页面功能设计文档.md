# 场外基金投资辅助工具 - 交易页面功能设计文档

## 一、功能概述

### 1. 功能名称与编号
- 功能名称：交易页面
- 功能编号：FE-TRADE-001

### 2. 所属模块
- 所属模块：底部导航栏核心功能
- 入口来源：底部导航栏切换

### 3. 用户角色与权限
- 用户角色：登录用户（必须登录才能交易）
- 权限说明：
  - 登录用户可查看账户信息、持仓概览、交易记录
  - 已开通交易权限用户可执行买入、卖出、定投等操作
  - 不同用户可能有不同的交易限额和权限范围

### 4. 功能目标与价值
- **功能目标**：提供用户进行基金交易和管理的统一入口，集中展示账户信息、持仓状况和交易操作，简化用户的投资操作流程。
- **功能价值**：
  - 集中管理用户的交易活动和账户资产
  - 提供便捷的买入、卖出、定投等核心交易功能
  - 实时展示持仓数据和盈亏情况
  - 支持交易记录查询和分析
  - 提供数据导入导出功能，便于投资管理和分析

### 5. 优先级与上线计划
- 优先级：高（核心交易功能，直接影响用户使用核心价值）
- 上线计划：
  - 第一阶段（MVP）：实现账户信息展示、持仓概览、交易记录查询
  - 第二阶段：添加买入、卖出、定投等核心交易功能
  - 第三阶段：完善数据导入导出、交易分析和高级交易功能

## 二、业务背景与依赖

### 1. 业务场景描述
用户登录应用后，通过底部导航栏进入交易页面，需要查看自己的账户资产、持仓情况，以及执行基金的买入、卖出、定投等交易操作。同时，用户也需要查询历史交易记录，进行数据分析和管理。交易页面作为用户执行投资操作的核心界面，需要提供直观、安全、便捷的操作体验。

### 2. 前置条件
- 用户已登录应用
- 用户已完成实名认证（根据监管要求）
- 用户已开通基金交易账户
- 交易系统和基金数据服务正常运行

### 3. 依赖模块与接口
- **用户认证服务**：验证用户身份和交易权限
- **账户服务**：获取和更新用户账户信息、资金余额
- **交易服务**：处理买入、卖出、定投等交易请求
- **持仓服务**：获取和更新用户持仓信息
- **订单服务**：管理交易订单和交易记录
- **支付服务**：处理资金支付和收款
- **OCR服务**：支持数据导入时的文档识别

### 4. 数据来源
- **用户账户数据**：总资产、可用资金、冻结资金等
- **持仓数据**：持有基金、份额、成本、市值、盈亏等
- **交易数据**：历史交易记录、订单状态等
- **市场数据**：基金实时净值、行情等

## 三、核心功能模块

### 1. 账户信息区
- **总资产展示**：显示用户总资产金额，大号字体突出
- **资金明细**：显示可用资金、冻结资金等明细
- **账户类型**：显示用户账户类型和状态
- **风险评估状态**：显示用户风险评估结果和有效期
- **账户管理入口**：进入账户详情和设置页面

### 2. 持仓概览区
- **持仓基金列表**：显示用户持有的所有基金，按市值或盈亏排序
- **单只基金信息**：显示基金名称、代码、持有份额、成本、当前市值、当日盈亏、累计盈亏
- **持仓统计**：显示持有基金数量、总盈亏金额和盈亏率
- **操作入口**：对单只基金提供卖出、定投、查看详情等快捷操作

### 3. 交易操作区
- **买入入口**：快速买入功能入口
- **卖出入口**：快速卖出功能入口
- **定投设置**：基金定投功能入口
- **转换功能**：基金转换功能入口（如有）
- **智能投顾**：智能投资建议和组合配置（高级功能）

### 4. 交易记录区
- **记录列表**：按时间倒序显示买入、卖出、定投等历史交易记录
- **记录详情**：每笔交易的详细信息（基金名称、交易时间、金额、份额、手续费等）
- **状态筛选**：支持按交易状态（成功、失败、处理中）筛选
- **类型筛选**：支持按交易类型（买入、卖出、定投）筛选
- **时间筛选**：支持按时间段筛选交易记录

### 5. 数据管理区
- **数据导入功能**：支持从图片、文件导入持仓数据
- **截图导入流程**：支持通过OCR技术识别基金持仓截图
- **数据导出功能**：支持导出交易记录、持仓数据等
- **数据分析工具**：提供基础的投资分析功能（如收益率分析、资产配置分析）

## 四、业务流程

### 1. 交易页面加载流程
1. 用户通过底部导航栏进入交易页面
2. 系统验证用户登录状态和交易权限
3. 并行加载账户信息、持仓数据、最近交易记录
4. 页面先显示骨架屏或加载动画
5. 数据加载完成后，依次渲染各模块内容

### 2. 买入交易流程
1. 用户点击买入按钮
2. 进入买入页面，输入基金代码或名称
3. 选择买入金额，确认交易信息
4. 提交交易订单
5. 输入交易密码或进行身份验证
6. 系统处理订单并返回订单状态
7. 交易完成后返回交易页面，更新持仓信息

### 3. 卖出交易流程
1. 用户在持仓列表中选择要卖出的基金
2. 点击卖出按钮，进入卖出页面
3. 输入卖出份额或金额
4. 确认交易信息和费用
5. 提交交易订单
6. 输入交易密码或进行身份验证
7. 系统处理订单并返回订单状态
8. 交易完成后返回交易页面，更新持仓信息

### 4. 数据导入流程
1. 用户进入账户管理页
2. 点击"截图导入"按钮
3. 选择图片源（相机/相册）
4. 拍摄/选择基金持仓截图
5. 系统进行OCR识别
6. 显示识别结果，供用户确认/编辑
7. 用户确认后，数据保存到持仓
8. 提示导入成功，更新持仓显示

## 五、交互设计

### 1. 页面布局
- **整体布局**：顶部标题栏 + 可滚动内容区 + 底部导航栏
- **顶部区域**：高度50px，包含页面标题和可能的筛选按钮
- **内容区域**：垂直滚动，包含账户信息、持仓概览、交易操作、交易记录等模块
- **底部导航栏**：高度50px，固定底部，包含首页、自选、市场、交易、我的五个导航项
- **响应式适配**：
  - 手机端：单列布局，内容垂直排列
  - 平板端：部分模块可并排显示，利用更宽屏幕空间

### 2. 操作路径
- **查看账户详情**：点击账户信息区 > 账户详情页
- **买入基金**：点击交易操作区买入按钮 > 买入页面
- **卖出基金**：在持仓列表选择基金 > 点击卖出按钮 > 卖出页面
- **设置定投**：在持仓列表选择基金 > 点击定投按钮 > 定投设置页
- **查看交易详情**：在交易记录列表点击单条记录 > 交易详情页
- **导入数据**：点击数据管理区导入按钮 > 选择导入方式 > 上传/拍摄图片

### 3. 交互反馈
- **下拉刷新**：支持下拉刷新页面数据
- **加载状态**：数据加载时显示骨架屏或加载动画
- **点击反馈**：所有可点击元素有触摸反馈效果
- **状态变化**：持仓数据更新时有平滑过渡动画
- **交易确认**：重要交易操作需要二次确认弹窗
- **操作成功/失败**：使用Toast提示，成功绿色，失败红色

### 4. 状态变化
- **持仓盈亏状态**：根据盈亏情况使用不同颜色标识
- **订单状态**：显示交易订单的处理状态（处理中、成功、失败等）
- **筛选状态**：显示当前筛选条件，提供清除筛选选项
- **数据加载状态**：显示数据加载进度或状态

## 六、字段级规范

### 1. 账户信息表

| 字段名称 | 类型 | 长度 | 默认值 | 校验规则 | 显示规则 | 操作权限 |
|---------|------|------|--------|---------|---------|--------|
| 账户总资产 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 大号字体显示 | 登录用户可见 |
| 可用资金 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |
| 冻结资金 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |
| 账户状态 | 文本 | 20 | "正常" | 枚举值 | 文本显示 | 登录用户可见 |
| 风险等级 | 文本 | 10 | "R3" | R1-R5 | 文本显示 | 登录用户可见 |
| 风险评估有效期 | 日期 | - | - | 有效日期格式 | 文本显示 | 登录用户可见 |

### 2. 持仓信息表

| 字段名称 | 类型 | 长度 | 默认值 | 校验规则 | 显示规则 | 操作权限 |
|---------|------|------|--------|---------|---------|--------|
| 基金名称 | 文本 | 50 | - | 非空 | 左对齐显示 | 登录用户可见 |
| 基金代码 | 文本 | 10 | - | 6位数字 | 灰色小字显示 | 登录用户可见 |
| 持有份额 | 数字 | 15 | 0.0000 | 数字格式，4位小数 | 正常字体显示 | 登录用户可见 |
| 持有成本 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |
| 当前市值 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |
| 当日盈亏 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 红绿色区分显示 | 登录用户可见 |
| 当日盈亏率 | 数字 | 10 | 0.00 | 数字格式，2位小数，带% | 红绿色区分显示 | 登录用户可见 |
| 累计盈亏 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 红绿色区分显示 | 登录用户可见 |
| 累计盈亏率 | 数字 | 10 | 0.00 | 数字格式，2位小数，带% | 红绿色区分显示 | 登录用户可见 |
| 最新净值 | 数字 | 10 | 0.0000 | 数字格式，4位小数 | 正常字体显示 | 登录用户可见 |

### 3. 交易记录表

| 字段名称 | 类型 | 长度 | 默认值 | 校验规则 | 显示规则 | 操作权限 |
|---------|------|------|--------|---------|---------|--------|
| 交易时间 | 日期时间 | - | - | 有效日期时间格式 | 左对齐显示 | 登录用户可见 |
| 基金名称 | 文本 | 50 | - | 非空 | 左对齐显示 | 登录用户可见 |
| 交易类型 | 文本 | 10 | - | 枚举值：买入/卖出/定投等 | 文本+图标显示 | 登录用户可见 |
| 交易金额 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |
| 交易份额 | 数字 | 15 | 0.0000 | 数字格式，4位小数 | 正常字体显示 | 登录用户可见 |
| 交易状态 | 文本 | 20 | - | 枚举值：成功/失败/处理中等 | 不同状态不同颜色 | 登录用户可见 |
| 手续费 | 数字 | 10 | 0.00 | 数字格式，2位小数 | 正常字体显示 | 登录用户可见 |

### 4. 订单信息表

| 字段名称 | 类型 | 长度 | 默认值 | 校验规则 | 显示规则 | 操作权限 |
|---------|------|------|--------|---------|---------|--------|
| 订单号 | 文本 | 30 | - | 非空 | 灰色小字显示 | 登录用户可见 |
| 交易时间 | 日期时间 | - | - | 有效日期时间格式 | 文本显示 | 登录用户可见 |
| 交易确认时间 | 日期时间 | - | - | 有效日期时间格式 | 文本显示 | 登录用户可见 |
| 订单状态 | 文本 | 20 | - | 枚举值 | 文本+状态码 | 登录用户可见 |
| 交易金额 | 数字 | 15 | 0.00 | 数字格式，2位小数 | 文本显示 | 登录用户可见 |
| 预计确认份额 | 数字 | 15 | 0.0000 | 数字格式，4位小数 | 文本显示 | 登录用户可见 |
| 实际确认份额 | 数字 | 15 | 0.0000 | 数字格式，4位小数 | 文本显示 | 登录用户可见 |
| 交易费率 | 数字 | 10 | 0.00 | 数字格式，2位小数，带% | 文本显示 | 登录用户可见 |

## 七、数据流转

### 1. 数据输入来源
- **用户认证数据**：用户登录凭证、权限信息
- **交易请求数据**：买入/卖出/定投等交易参数
- **账户数据**：用户账户状态、资金余额
- **持仓数据**：用户持有的基金份额、成本等
- **市场数据**：基金净值、行情等
- **导入数据**：用户导入的持仓数据或截图

### 2. 数据处理逻辑
- **交易处理**：验证交易参数，计算交易金额/份额，处理订单
- **数据校验**：验证输入数据的合法性和完整性
- **状态更新**：实时更新账户、持仓、订单状态
- **数据导入处理**：OCR识别、数据清洗、格式转换、验证和保存
- **数据导出处理**：数据格式化、文件生成、加密（如需）

### 3. 数据输出去向
- **页面展示**：更新页面显示的账户信息、持仓数据、交易记录
- **交易通知**：发送交易成功/失败等通知
- **数据导出**：生成导出文件供用户下载
- **交易日志**：记录交易操作和结果

### 4. 数据存储方式
- **账户数据**：存储在用户账户表中
- **持仓数据**：存储在用户持仓表中
- **交易记录**：存储在交易记录表中
- **订单数据**：存储在订单表中
- **导入数据**：临时存储在导入数据表中，验证后合并到正式表

## 八、异常处理

| 异常场景 | 触发条件 | 系统处理 | 用户提示 |
|---------|---------|---------|--------|
| 资金不足 | 买入/定投时账户资金不足 | 阻止交易，返回错误码 | "资金不足，请先充值" |
| 份额不足 | 卖出时持仓份额不足 | 阻止交易，返回错误码 | "份额不足，无法卖出" |
| 网络异常 | 交易过程中网络中断 | 保存交易状态，提供重试机制 | "网络异常，请检查网络后重试" |
| 交易失败 | 系统处理交易订单失败 | 记录失败原因，更新订单状态 | "交易失败：[失败原因]" |
| 导入识别失败 | OCR识别基金持仓截图失败 | 提示用户手动输入或重新拍摄 | "识别失败，请确保截图清晰或手动输入" |
| 导入数据校验失败 | 导入数据格式错误或不完整 | 提示错误字段，允许用户修改 | "导入数据验证失败：[错误字段]" |
| 交易密码错误 | 用户输入的交易密码不正确 | 提示错误，限制尝试次数 | "交易密码错误，请重新输入" |

## 九、非功能性需求

### 1. 性能要求
- **页面加载时间**：首屏内容加载时间<2秒（理想网络环境）
- **交易响应时间**：交易请求处理时间<3秒
- **数据导入处理时间**：OCR识别和处理时间<5秒
- **内存占用**：页面内存占用<120MB
- **并发处理**：支持同时处理多个交易请求

### 2. 兼容性要求
- **设备兼容性**：支持iOS 12+和Android 7.0+系统
- **浏览器兼容性**：针对H5版本支持主流移动端浏览器
- **分辨率适配**：支持320px-1200px宽度的设备
- **深色模式支持**：适配系统深色模式设置

### 3. 安全性要求
- **数据传输加密**：所有API请求采用HTTPS
- **交易加密**：交易数据使用额外加密保护
- **身份验证**：重要交易需要二次身份验证
- **防重放攻击**：实现防重放机制，避免交易重复提交
- **权限控制**：严格的用户权限校验，防止越权操作
- **敏感信息保护**：账户和交易数据严格保护，禁止未授权访问

### 4. 可访问性要求
- **文本对比度**：符合WCAG AA标准
- **触摸目标尺寸**：可点击元素尺寸不小于44x44px
- **内容可读性**：确保文字大小和间距符合阅读习惯
- **无障碍支持**：支持屏幕阅读器等辅助功能

## 十、测试要点

### 1. 功能测试
- 账户信息正确显示和实时更新
- 持仓列表正确显示和排序
- 买入交易流程完整测试（包括金额输入、确认、支付等）
- 卖出交易流程完整测试（包括份额选择、确认等）
- 定投设置功能测试
- 交易记录查询和筛选功能测试
- 数据导入功能测试（包括正常和异常场景）
- 数据导出功能测试

### 2. 边界测试
- 交易限额测试（最小/最大交易金额）
- 网络条件不稳定时的交易处理
- 大量持仓数据加载性能测试
- 极端市场条件下的交易处理
- 高并发交易场景测试

### 3. 异常测试
- 资金不足场景的处理
- 份额不足场景的处理
- 交易密码错误多次尝试
- 网络中断和恢复后的交易状态
- 数据导入失败场景处理
- 交易系统暂时不可用的降级处理

### 4. 兼容性测试
- iOS和Android平台的功能一致性
- 不同浏览器环境下的兼容性
- 低版本系统的功能降级处理
- 不同分辨率设备的UI适配

## 十一、场景与流程说明

### 1. 正常场景
1. **查看账户信息**：
   - 用户进入交易页面
   - 查看顶部显示的账户总资产和资金明细
   - 点击进入账户详情页查看更多信息

2. **买入基金流程**：
   - 用户点击交易操作区的买入按钮
   - 输入基金代码或名称查找基金
   - 输入买入金额，确认交易信息
   - 输入交易密码完成支付
   - 查看交易结果提示

3. **卖出基金流程**：
   - 用户在持仓列表找到要卖出的基金
   - 点击基金进入详情或直接点击卖出按钮
   - 选择卖出份额或金额
   - 确认交易信息和费用
   - 提交交易，输入密码验证
   - 查看交易结果提示

4. **数据导入流程**：
   - 用户进入账户管理或数据管理页面
   - 点击"截图导入"按钮
   - 选择从相册选择或拍照
   - 上传或拍摄基金持仓截图
   - 等待系统OCR识别
   - 查看识别结果，确认或修改信息
   - 点击保存，将数据导入到持仓

### 2. 异常场景
1. **资金不足**：
   - 用户尝试买入基金
   - 系统检测到账户资金不足
   - 弹出提示"资金不足，请先充值"
   - 提供充值入口

2. **交易失败**：
   - 用户提交买入/卖出交易
   - 由于系统原因或参数错误导致交易失败
   - 显示"交易失败：[失败原因]"
   - 提供重新尝试或联系客服选项

3. **导入识别失败**：
   - 用户上传不清晰的持仓截图
   - OCR识别失败或识别不准确
   - 提示识别失败原因
   - 提供手动输入或重新拍摄选项

## 十二、附件文档

1. **原型图链接**：[交易页面原型图](https://example.com/prototype/trade)
2. **流程图文件**：[交易流程流程图](https://example.com/flowchart/trade-process)
3. **设计规范参考**：[UI设计规范](https://example.com/design/guidelines)
4. **相关接口文档**：[交易接口文档](https://example.com/api/trade)
5. **OCR识别规范**：[OCR识别要求文档](https://example.com/api/ocr-spec)

## 十三、上线计划

### 1. 第一阶段（MVP）
- 实现账户信息展示模块
- 实现持仓概览基础功能
- 实现交易记录查询功能
- 实现基本的筛选功能
- 预计上线时间：2023年9月

### 2. 第二阶段
- 添加买入、卖出、定投等核心交易功能
- 完善交易确认和结果展示
- 实现账户管理相关功能
- 添加数据导入导出基础功能
- 预计上线时间：2023年10月

### 3. 第三阶段
- 完善数据导入功能，支持多种格式和OCR识别
- 优化数据导出功能，提供更多导出选项
- 添加交易分析和统计功能
- 实现智能投顾和高级交易功能
- 预计上线时间：2023年11月

## 十四、后续优化方向

1. **交易功能增强**：
   - 添加智能交易策略（如定投计划优化、止盈止损设置）
   - 支持更多交易类型（如基金转换、套利等）
   - 实现交易组合管理和一键调仓

2. **数据分析能力提升**：
   - 提供更全面的投资分析工具
   - 增加收益归因分析、风险评估等功能
   - 支持自定义报表和图表

3. **用户体验优化**：
   - 优化交易流程，减少操作步骤
   - 提供更个性化的交易界面设置
   - 增强交易指引和风险提示

4. **性能和安全优化**：
   - 进一步优化交易响应速度
   - 加强交易系统的安全性和稳定性
   - 实现离线交易功能（在网络恢复后自动提交）

---

**文档版本**：v1.0
**编写日期**：2023年8月17日
**审核人员**：产品经理、UI设计师、前端开发、后端开发、测试工程师